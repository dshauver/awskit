<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.14
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-awskit">awskit</h1>

<h2 id="label-Table+of+Contents">Table of Contents</h2>
<ol><li>
<p><a href="#label-Description">Description</a></p>
</li><li>
<p><a href="#label-Setup">Setup</a></p>
</li><li>
<p><a href="#label-Usage">Usage - Configuration options and additional
functionality</a></p>
</li><li>
<p><a href="#label-Limitations">Limitations - OS compatibility, etc.</a></p>
</li></ol>

<h2 id="label-Description">Description</h2>

<p>This module helps deploying SE demo infrastructure in AWS in various
regions.</p>

<p>It assumes a “Demo Reboot” Puppetmaster AMI is available in your region.</p>

<p>The module uses module-level hiera to store all configuration. The
hierarchy is expressed as follows in hiera.yaml:</p>

<pre class="code ruby"><code class="ruby">- name: &quot;AWS region-level user-level data&quot;
    path: &quot;%{::aws_region}/%{::user}.yaml&quot;

  - name: &quot;User-level data&quot;
    path: &quot;%{::user}.yaml&quot;

  - name: &quot;AWS region-level data&quot;
    path: &quot;%{::aws_region}/common.yaml&quot;

  - name: &quot;Common data&quot;
    path: &quot;common.yaml&quot;</code></pre>

<h2 id="label-Setup">Setup</h2>

<h3 id="label-AWS+setup">AWS setup</h3>
<ol><li>
<p>Make sure you have your AWS credentials (Access key and Secret key).</p>
</li><li>
<p>If you don&#39;t already have one, make sure you create an AWS SSH keypair
in the region you are going to use.</p>
</li></ol>

<p>(To create a keypair, go to <a
href="https://console.aws.amazon.com/ec2/v2/home#KeyPairs">console.aws.amazon.com/ec2/v2/home#KeyPairs</a>)</p>

<h3 id="label-Setup+on+your+Mac">Setup on your Mac</h3>

<pre class="code ruby"><code class="ruby">brew install awscli
aws configure # needed for your AWS access
export AWS_REGION=$your_region # speeds up puppet aws module tremendously
export FACTER_aws_region=$your_region # needed for hiera
export FACTER_user=$your_user_name # needed for hiera
sudo /opt/puppetlabs/puppet/bin/gem install aws-sdk retries --no-ri --no-rdoc
puppet module install puppetlabs/aws
puppet module install puppetlabs/stdlib
</code></pre>

<h2 id="label-Usage">Usage</h2>

<h3 id="label-Clone+the+awskit+repo">Clone the awskit repo</h3>

<pre class="code ruby"><code class="ruby">git clone https://github.com/puppetlabs-seteam/awskit.git</code></pre>

<h3 id="label-Configure+hiera">Configure hiera</h3>
<ul><li>
<p>cd to the module dir <code>cd awskit</code></p>
</li><li>
<p>Configure region-specific AMI ids in the hash <code>awskit::amis</code> in
the <code>data/common.yaml</code> file</p>
</li><li>
<p>If not done yet, create the file
<code>data/${FACTER_aws_region}/common.yaml</code> and configure 
region-specific AWS variables</p>
</li><li>
<p>If not done yet, reserve a static IP for your master by doing:  <code>aws
ec2 allocate-address --region ${FACTER_aws_region}</code></p>
</li><li>
<p>Create the file <code>data/${FACTER_aws_region}/${FACTER_user}.yaml</code>
and add  your <code>awskit::key_name</code> and
<code>awskit::master_ip</code></p>
</li><li>
<p>Create the file <code>data/${FACTER_user}.yaml</code> and configure
user-specific variabls (such as tags)</p>
</li></ul>

<h3 id="label-Provision+the+master">Provision the master</h3>
<ul><li>
<p>run <code>tasks/provision.sh master</code></p>
</li></ul>

<h3 id="label-Provision+count+linux+agents">Provision count linux agents</h3>
<ul><li>
<p>run <code>tasks/provision.sh linux_node &lt;count&gt;</code></p>
</li></ul>

<h3 id="label-Provision+count+windows+agents">Provision count windows agents</h3>
<ul><li>
<p>run <code>tasks/provision.sh windows_node &lt;count&gt;</code></p>
</li></ul>

<h3 id="label-Provision+the+Puppet+Discovery+VM">Provision the Puppet Discovery VM</h3>
<ul><li>
<p>run <code>tasks/provision.sh discovery</code></p>
</li></ul>

<h3 id="label-Provision+the+Windows+Domain+Controller">Provision the Windows Domain Controller</h3>
<ul><li>
<p>run <code>tasks/provision.sh windc</code></p>
</li></ul>

<h3 id="label-Provision+the+CD4PE+host">Provision the CD4PE host</h3>
<ul><li>
<p>run <code>tasks/provision.sh cd4pe</code></p>
</li></ul>

<h3 id="label-Configure+the+control+repo">Configure the control repo</h3>

<p>First, make sure to install bolt.</p>

<p>Next run the following task on the local machine. This will push the
contents of the control repo you specify to Puppetmaster&#39;s local GOGS
server (which is hosted at <a
href="http://$puppet_ip:3000">$puppet_ip:3000</a>). Optionally, you can add
your own public key to GOGS so you can start pushing your changes to the PM
riectly.</p>

<p>Note:</p>
<ul><li>
<p>$public_key_name can be any string - gogs will register this public key
under this name.</p>
</li><li>
<p>$public_key_value should contain your public key string</p>
</li></ul>

<pre class="code ruby"><code class="ruby">bolt task run awskit::conf_control_repo --modulepath .. -n $master_ip control_repo=&quot;https://github.com/puppetlabs-seteam/control-repo-awskit.git&quot; public_key_name=$key_name public_key_value=&quot;${your_pub_key}&quot; -u root -p #--debug --verbose</code></pre>

<p>After this, you can add a remote to your local awskit control repo clone:</p>

<pre class="code ruby"><code class="ruby">git clone https://github.com/puppetlabs-seteam/control-repo-awskit.git
cd control-repo-awskit
git remote add awskit git@${master_ip}:puppet/control-repo.git</code></pre>

<p>Now, you can push your changes directly to the master&#39;s gogs server
(which lives at <a href="http://$master_ip&quot;&gt;${master_ip&lt;/a&gt;):</p>

<pre class="code ruby"><code class="ruby">git commit -m &quot;some commit&quot;
git push awskit production</code></pre>

<h2 id="label-Limitations">Limitations</h2>
</div></div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>