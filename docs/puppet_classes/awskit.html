<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: awskit
  
    &mdash; Documentation by YARD 0.9.14
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_classes::awskit";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (a)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">awskit</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: awskit</h1>
<div class="box_info">
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/init.pp
    </dd>
  </dl>
</div>

  <h2>Summary</h2>
  Placeholder for hiera parameters

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<p>awskit</p>

<p>Provides a central place to configure parameters using hiera. Also selects
the right AMI ids based on current region.</p>

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_awskit'>awskit</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Name of the AWS keypair, this is region-dependent.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>region</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>this is the AWS region, looked up in hiera. Hiera gets it from the
aws_region fact which you can set with the <code>FACTER_aws_region</code>
environment variable. Also recommended to set the <code>AWS_REGION</code>
enviroinment variable to the same region since this speeds up the
puppetlabs/aws module considerably)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>vpc</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The VPC the instances should go into. awskit currently does not create VPCs
or subnets, these should be present in the region and configured in
<code>%{::aws_region}/common.yaml</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>availability_zone</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The availability zone the instances should go into. Should be configured in
<code>%{::aws_region}/common.yaml</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>subnet</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The subnet the instances should go into. Should be configured in
<code>%{::aws_region}/common.yaml</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>tags</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>AWS instance tags. Provided in common.yaml. The created_by tag can be
provided in <code>%{::user}.yaml</code> and deep merged.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>master_ip</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>AWS PM master IP address. Since this address should not change across
instance restarts, you would need an Elastic IP address for this. See
README for the AWS cli command to create one.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>amis</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The central hash of AMIs, which lives on <code>common.yaml</code>. Rather
than providing AMIs per region, they are all in the same hash for easier
maintenance. This class creates variables with the correct AMIs based on
the region.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>wsus_ip</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The IP address for the WSUS server, if you use it in your environment. Also
needs an EIP (see <code>master_ip</code>).</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>ssh_ingress_cidrs</span>
      
      
        <span class='type'>(<tt>Array[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[&#39;0.0.0.0/0&#39;]</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The ingress CIDR for ssh access of the master.</p>
</div>
      
    </li>
  
</ul>


</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/init.pp', line 30</span>

class awskit(
  String $key_name,
  String $region,
  String $vpc,
  String $availability_zone,
  String $subnet,
  Hash $tags,
  String $master_ip,
  Hash $amis,
  String $wsus_ip = undef,
  Array[String] $ssh_ingress_cidrs = [&#39;0.0.0.0/0&#39;],
  ) {

    $pm_ami         = $amis[$region][&#39;pm&#39;]
    $centos_ami     = $amis[$region][&#39;centos&#39;]
    $windows_ami    = $amis[$region][&#39;windows&#39;]
    $discovery_ami  = $amis[$region][&#39;discovery&#39;]
    $windc_ami      = $amis[$region][&#39;windc&#39;]
    $wsus_ami       = $amis[$region][&#39;wsus&#39;]

    notify { &quot;tags: ${tags}&quot;: }

    $default_ingress = [
      { protocol =&gt; &#39;tcp&#39;,  port =&gt; 443,       cidr =&gt; &#39;0.0.0.0/0&#39;, },
      { protocol =&gt; &#39;tcp&#39;,  port =&gt; 3000,      cidr =&gt; &#39;0.0.0.0/0&#39;, },
      { protocol =&gt; &#39;tcp&#39;,  port =&gt; 8140,      cidr =&gt; &#39;0.0.0.0/0&#39;, },
      { protocol =&gt; &#39;tcp&#39;,  port =&gt; 8142,      cidr =&gt; &#39;0.0.0.0/0&#39;, },
      { protocol =&gt; &#39;tcp&#39;,  port =&gt; 8143,      cidr =&gt; &#39;0.0.0.0/0&#39;, },
      { protocol =&gt; &#39;tcp&#39;,  port =&gt; 8170,      cidr =&gt; &#39;0.0.0.0/0&#39;, },
      { protocol =&gt; &#39;tcp&#39;,  port =&gt; 61613,     cidr =&gt; &#39;0.0.0.0/0&#39;, },
      { protocol =&gt; &#39;icmp&#39;,                    cidr =&gt; &#39;0.0.0.0/0&#39;, }
    ]

    $ssh_ingress = $ssh_ingress_cidrs.map | $ssh_rule | {
      { protocol =&gt; &#39;tcp&#39;,  port =&gt; 22, cidr =&gt; $ssh_rule }
    }

    $ingress = flatten([$default_ingress, $ssh_ingress])

    ec2_securitygroup { &#39;awskit-master&#39;:
      ensure      =&gt; present,
      region      =&gt; $awskit::region,
      vpc         =&gt; $awskit::vpc,
      description =&gt; &#39;SG for awskit Master&#39;,
      ingress     =&gt; $ingress,
    }

    ec2_securitygroup { &#39;awskit-agent&#39;:
      ensure      =&gt; &#39;present&#39;,
      region      =&gt; $awskit::region,
      vpc         =&gt; $awskit::vpc,
      description =&gt; &#39;ssh and http(s) ingress for awskit agent&#39;,
      ingress     =&gt; [
        { protocol =&gt; &#39;tcp&#39;, port =&gt; 22,   cidr =&gt; &#39;0.0.0.0/0&#39;, },
        { protocol =&gt; &#39;tcp&#39;, port =&gt; 80,   cidr =&gt; &#39;0.0.0.0/0&#39;, },
        { protocol =&gt; &#39;tcp&#39;, port =&gt; 443,  cidr =&gt; &#39;0.0.0.0/0&#39;, },
        { protocol =&gt; &#39;tcp&#39;, port =&gt; 3306, security_group =&gt; &#39;awskit-agent&#39;, }, # MySQL
        { protocol =&gt; &#39;tcp&#39;, port =&gt; 3389, cidr =&gt; &#39;0.0.0.0/0&#39;, }, # RDP
        { protocol =&gt; &#39;tcp&#39;, port =&gt; 5985, cidr =&gt; &#39;0.0.0.0/0&#39;, }, # WinRM HTTP
        { protocol =&gt; &#39;tcp&#39;, port =&gt; 5986, cidr =&gt; &#39;0.0.0.0/0&#39;, }, # WinRM HTTPS
        { protocol =&gt; &#39;tcp&#39;, port =&gt; 8080, cidr =&gt; &#39;0.0.0.0/0&#39;, },
        { protocol =&gt; &#39;tcp&#39;, port =&gt; 8888, security_group =&gt; &#39;awskit-agent&#39;, }, # rgbank webhead
        { protocol =&gt; &#39;icmp&#39;,              cidr =&gt; &#39;0.0.0.0/0&#39;, },
      ],
    }

}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>